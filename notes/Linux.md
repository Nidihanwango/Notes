# Linux 笔记

## Linux 基础篇

### 网络连接的三种方法

- 桥接模式，虚拟系统可以和外部系统进行通讯，但是容易造成IP冲突
- NAT模式，网络地址转换模式，虚拟系统可以和外部系统进行通讯，不会造成IP冲突
- 主机模式，独立的系统，不与外部发生联系

### 虚拟机克隆

- 方式一 
  - 直接拷贝一份安装好的虚拟机文件
- 方式二
  - 使用VMware的克隆操作
  - 克隆时需要先关闭Linux系统

### 虚拟机快照

- 利用VMware快照管理功能，可以快速将系统恢复到之前正常运行的状态

### 虚拟机的迁移和删除

- 在VMware安装的虚拟机的本质是文件，想要对虚拟机进行迁移或者删除操作，只需要对相对应的虚拟机文件进行操作

### 安装VMtools

- 安装VMtools可以在Windows下更好的管理VM虚拟机
- 可以设置Windows和虚拟机的共享文件夹
- 安装 VMtools 的步骤
  -  进入centos
  - 弹出镜像光驱
  - 设置虚拟机CD/DVD(SATA) 使用iso镜像文件
    - 文件指向vmware安装目录中的 **linux.iso**
  - 点击 vm 菜单的 install vmware tools
  - centos 会出现一个 vm 的安装包，xx.tar.gz
  - 拷贝到 /opt 
  - 使用解压命令 tar ，得到一个安装文件
    - tar -zxvf xx.tar.gz
  - 进入该 vm 解压的目录，/opt 目录下
  - 安装 ./vmware-install.pl
  - 全部使用默认设置即可安装成功
    - 出现Would you like to recover the wasted disk space by uninstalling VMware Tools at
      this time? (yes/no) [yes]  这条日志时需要输入 **no**
  - 注意
    - 安装 vmtools 需要有 gcc
      - gcc -v 查看 gcc 

### 使用 vmtools 设置共享文件夹

- 步骤

  - 打开虚拟机设置中的选项，设置共享文件的路径和总是启用即可

  - centos 下共享文件夹路径为 /mnt/hgfs

- 注意事项和细节说明
  - 在实际开发中，windows 和 linux 不在同一台机器上，需要通过远程方式实现文件的上传下载

### Linux 目录结构

- linux 的文件系统采用层级式树状目录结构，在此结构的最上层是根目录 **/** ，然后在此目录下创建其他目录
- 在linux中，一切皆文件
  - 在linux中，硬件会被映射为一个个的文件进行管理
- 具体的目录结构
  - /bin ( /usr/bin，/usr/local/bin )
    - 是 Binary 的缩写，这个目录存放着最经常常用的命令
  - /sbin ( /usr/sbin，/usr/local/sbin )
    - s 表示 super user 的意思，这里存放的是系统管理员使用的系统管理程序
  - /home
    - 存放普通用户的主目录，在 Linux 中，每个用户都会有一个自己的主目录，一般该目录名是以用户的账号命名
  - /root
    - 该目录为系统管理员，也称作超级权限者的用户主目录
  - /lib
    - 系统开机所需要的最基本的动态链接共享库，其作用类似 Windows 中的 DLL 文件，几乎所有的应用程序都需要用到这些共享库
  - /lost+found 
    - 这个目录一般是空的，当系统非法关机后，这个目录中就出现了一些文件
  - /etc
    - 所有的系统管理所需要的配置文件和子目录，my.conf
  - /usr
    - 一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于 windows 下的 program files 目录
  - /boot
    - 存放的是使用 linux 时，使用的一些核心文件，包括一些连接文件和镜像文件
  - /proc **不能动**
    - 这个目录是一个虚拟的目录，它是系统内存的映射，访问这个目录来获取系统信息
  - /srv **不能动**
    - service 的缩写，该目录存放一些服务启动之后需要提取的数据
  - /sys **不能动**
    - 这是 linux 2.6 内核的一个很大的变化，该目录下安装了 2.6 内核中新出现的一个文件系统 sysfs 
  - /tmp
    - 临时文件目录
  - /dev
    - 类似于 windows 的设备管理器，把所有的硬件用文件的形式存储
  - /media
    - linux 系统会自动识别一些设备，例如 U盘 光驱等等，当识别后，linux 会把识别的设备挂载到这个目录下
  - /mnt
    - 系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将外部存储挂载到 /mnt 上，然后进入该目录就可以查看里面的内容了
    - 例如上面的共享文件夹 **/mnt/hgfs**
  - /opt
    - 这是给主机额外安装软件存放的目录，如安装 oracle 数据库就可以存放到该目录下，默认为空
  - /usr/local
    - 这是另一个给主机额外安装软件所存放的目录，一般是通过源码方式安装的程序
  - /var
    - 这个目录存放着不断扩充着的东西，习惯将经常被修改的目录放在这个目录下，包括各种日志文件
  - /selinux [ security-enhanced linux ]
    - SELinux 是一种安全子系统，它能控制程序只能访问特定文件，有三种工作模式，可以自行设置
    - 默认关闭，使用需手动打开

## Linux 实操篇

### 远程登录 Linux 服务器

- Xshell 用于远程登录 Linux 服务器
- 操作步骤
  - Xshell 连接 Linux 服务器
    - 需要知道 Linux 服务器的 IP 地址，使用 ifconfig 命令查看
    - 然后在 Windows 上使用 ping <ip> 的方式测试是否能够正常连接 Linux 服务器
    - 根据 Xshell 软件提示新建连接
      - 名称随便设置
      - 主机为 Linux 的 IP 地址
      - 端口号为 22

### 远程文件传输

- Xftp 用于远程的文件上传与下载
- 操作步骤
  - 与 Xshell 的使用相似
  - 在新建连接时，选择协议为 SFTP，端口号为 22
  - 如何处理中文乱码
    - 修改连接 属性-编码 为 **utf-8**

### Vim 编辑器

#### Vim 三种模式及切换

- 正常模式
  - 进入 vim 的默认模式
  - 可以移动光标，可以删除字符或者删除整行，可以使用复制、粘贴来修改文档内容
- 插入模式
  - 在正常模式下，按 i、o、a、r 进入插入模式，也就是编辑模式
  - 按 Esc 键退出插入模式
- 命令行模式
  - 在正常模式下，输入 **:** 进入命令行模式
  - 可以输入指令来完成读取、存盘、替换、离开 vim、显示行号等操作

#### Vim 快捷键

- 复制当前行，在一般模式下输入  **yy**
- 复制当前向下五行，在一般模式下输入 **5yy**
- 粘贴，在一般模式下输入  **p**
- 删除当前行，在一般模式下输入  **dd**
- 文件中查找某个单词 ，在一般模式下输入 **/** 进入命令行模式，然后在 **/** 后面输入要查找的单词，例如 **/hello**
- 设置行号  **:set nu**
- 取消行号  **:set nonu**
- 定位文件最末行，在一般模式下输入  **G**
- 定位文件首行，在一般模式下输入  **gg**
- 撤销，在一般模式下输入  **u**
- 光标跳至指定行号 ，在一般模式下输入，输入 **20** ，再输入 **shift+g** 

### 开机、重启、用户的登录注销

#### 关机、重启命令

- 立刻关机  **shutdown -h now**  等同于  **halt**
- 一分钟后关机  **shutdown -h 1**  输入 **shutdown** 不加任何参数，默认即为前面的命令，即一分钟后关机
- 立即重启计算机  **shutdown -r now**  等同于 **reboot**
- 把内存的数据同步到硬盘  **sync**
- tips: 建议在关机或者重启前，先运行 **sync**，把内存中的数据写入磁盘

#### 用户登录和注销

- 切换用户
  - **su root** 
- 注销
  - **exit**
  - **logout** 
    - 使用 **su - root** 切换用户时，才可以用 **logout** 注销

### 用户管理

#### 基本介绍

- Linux 系统是一个多用户，多任务的操作系统，任何一个要使用系统资源的用户，都必须首先向系统管理员申请一个账号，然后以这个账号的身份进入系统

#### 添加用户

- 基本语法
  - **useradd** **<用户名>**
- 应用案例
  - 添加一个用户 **tom**，默认该用户的家目录在 **/home/tom**
- 细节说明
  - 当创建用户成功后，会自动创建和用户同名的家目录
  - 可以通过 **useradd -d <指定目录> <新的用户名>**，给新创建的用户指定家目录

#### 指定、修改密码

- 基本语法
  - **passwd <用户名>**
- tips：**pwd** 显示当前所在目录

#### 删除用户

- 基本语法
  - **userdel <用户名>**
    - 删除用户，保留家目录
  - **userdel -r <用户名>**
    - 删除用户以及该用户家目录

- tips：一般情况下，建议保留家目录

#### 查询用户信息

- **id <用户名>**

#### 切换用户

- **su - <用户名>**

#### 查看当前登录的用户信息

- **who am i**

#### 用户组

- 介绍
  - 类似于角色，系统可以对有共性/权限的多个用户进行统一的管理
- 新增组
  - **groupadd <组名>**
- 删除组
  - **groupdel <组名>**
- 创建用户时指定组
  - **useradd -g <用户组> <用户名>**
- 修改用户的组
  - **usermod -g <用户组> <用户名>** 

#### 用户和组相关的文件

- **/etc/passwd** 文件
  - 用户（user）的配置文件，记录用户的各种信息
  - 每行的含义
    - 用户名：口令：用户标识符：组标识符：注释性描述：主目录：登录 shell
- **/etc/shadow** 文件
  - 口令的配置文件
  - 每行的含义
    - 登录名：加密口令：最后一次修改时间：最小间隔时间：最大间隔时间：警告时间：不活动时间：失效时间：标志
- **/etc/group** 文件
  - 组（group）配置文件，记录 linux 包含组的信息
  - 每行的含义
    - 组名：口令：组标识号：组内用户列表

### 实用指令

#### 指定运行级别

- 基本介绍
  - 0  关机
  - 1  单用户（找回丢失密码）
  - 2  多用户状态没有网络服务
  - 3  多用户状态有网络服务
  - 4  系统未使用，保留给用户定义
  - 5  图形界面
  - 6  系统重启
- 使用语法
  - **init <运行级别 [ 0、1、2、3、4、5、6 ] >**
  - 例如 **init 6** 系统重启
- 指定默认运行级别（Centos7 之后）
  - **/etc/inittab** 文件中
    - **multi-user.target**：analogous to runlevel 3
    - **graphical.target**：analogous to runlevel 5
    - To view current default target，run：
      - **systemctl get-default**
    - To set a default target，run：
      - **systemctl set-default <Target>.target**

#### 找回 root 密码

centos7之后的方法

1. 首先，启动系统，进入开机界面，在选择系统的界面中按 **e**，进入编辑模式
2. 进入编辑模式后，找到以 **Linux16** 开头内容所在行，在行的末尾添加 **init=/bin/sh**
3. 输入完成后，按快捷键 **Ctrl + x** 进入单用户模式
4. 然后输入 **mount -o remount，rw /** ，按 Enter 键
5. 接着输入 **passwd**，设置密码，然后确认密码，修改成功后会显示 passwd......的样式
6. 继续输入 **touch /.autorelabel**，按 Enter 键
7. 再输入 **exec /sbin/init**，按 Enter 键
8. 等待系统自动修改密码，这个过程时间可能有点长，耐心等待，完成后，系统会自动重启

#### 帮助指令

- man 获得帮助信息
  - 基本语法
    - **man <命令或配置文件>**
    - 例如  **man ls**
    - 在linux下，隐藏文件是以 **.** 开头
- help 指令
  - 基本语法
    - **help <命令>**
  - 功能描述
    - 获得 shell 内置命令的帮助信息
    - 例如 **help cd**

#### 文件目录指令

- **pwd**
  - 显示当前工作目录的绝对路径
- **ls**
  - 显示当前目录中的文件和子目录
- **mkdir**
  - 创建目录
  - 常用选项
    - **-p**
      - 创建多级目录
- **rmdir**
  - 删除空目录
- **rm -rf**
  - 如果要删除非空目录，使用这个命令
- **touch**
  - 创建空文件，touch hello.txt
- **cp**
  - 拷贝文件到指定目录
  - 基本语法
    - **cp [ 选项 ] source dest**
  - 常用选项
    - **-r** 递归复制整个文件夹
    - **\cp -r** 强制覆盖整个文件夹，不提示
- **rm**
  - 删除文件或者目录
  - 基本语法
    - **rm [ 选项 ] 要删除的文件或者目录**
  - 常用选项
    - **-r** 递归删除整个文件夹
    - **-f** 强制删除不提示
- **mv**
  - 移动文件与目录或者重命名
  - 基本语法
    - mv oldNameFile newNameFile  // 重命名
    - mv /temp/movefile /targetFolder  // 移动文件
    - mv /home/tom /root  // 移动目录，不需要加参数
- **cat**
  - 查看文件内容
  - 基本语法
    - **cat [ 选项 ] 要查看的文件**
  - 常用选项
    - **-n** 显示行号
  - 可以与管道命令组合使用
    - **cat -n /etc/profile | more**
- **more** 
  - more 指令是一个基于 vi 编辑器的文本过滤器，它以全屏幕的方式按页显示文本文件的内容
  - more指令中内置了若干快捷键（交互的指令）
  - 基本语法
    - **more** 要查看的文件
  - 操作说明
    - **空格**  代表向下翻一页
    - **Enter**  代表向下翻一行
    - **q**  表示退出
    - **Ctrl + F**  向下滚动一屏
    - **Ctrl + B**  返回上一屏
    - **=**  输出当前行的行号
    - **:f**  输出当前文件名和当前行的行号
- **less**
  - less 指令用于分屏查看文件内容，它的功能与 more 指令类似，但是比 more 更加强大，支持各种显示终端。
  - less 指令在显示文件内容的时候，并不是一次性将整个文件都加载完才显示的，而是根据显示需要加载内容，对于显示大型文件具有较高的效率
  - 基本语法
    - **less** 要查看的文件
  - 操作说明
    - 空格键  向下翻一页
    - pagedown键  向下翻一页
    - pageup键  向上翻一页
    - **/** 字串，向下搜寻字串，**n** 向下查找，**N** 向上查找
    - **？** 字串，向上搜寻字串，**n** 向上查找，**N** 向下查找
    - **q** 离开 less
- **echo**
  - echo 输出内容到控制台
  - 基本语法
    - echo [ 选项 ] [ 输出内容 ]
  - 例如
    - echo $PATH
    - echo $HOSTNAME
    - echo "hello，world!"
- **head**
  - 显示文件开头的部分
  - **head 文件**   默认显示文件前十行内容
  - **head -n 5**    显示文件的前五行内容
- **tail**
  - 用于显示文件结尾部分的内容
  - 默认显示文件后十行的内容
  - 基本语法
    - **tail 文件**  查看文件后十行的内容
    - **tail -n x 文件** 查看后x行的内容
    - **tail -f 文件**  实时追踪该文档的所有更新
- 输出重定向
  - **>** 覆盖
  - **>>** 追加
- **ln**
  - 软链接，又称为符号链接，类似于 windows 中的快捷方式，主要存放了链接其他文件的路径
  - 基本语法
    - **ln -s [ 原文件或目录 ]  [ 软链接名 ]**  给原文件创建一个软链接
  - 例如
    - **ln -s /root/ /home/myroot**
- **history**
  - 查看已经执行过的历史命令，也可以执行历史命令
  - 基本语法
    - history
  - 显示所有历史命令  **history**
  - 显示最近使用过的10个指令  **history 10**
  - 执行历史编号为5的指令  **!5**

#### 时间日期指令

- **date** 指令，显示当前日期
  - 基本语法
    1. **date** 显示当前时间
    2. **date + %Y**  显示当前年份
    3. **date + %m**  显示当前月份
    4. **date + %d**  显示当前是哪一天
    5. **date  "+%Y-%m-%d %H:%M:%S"**   显示年月日时分秒
    6. **date -s "2011-11-11 11:11:11"**  设置系统当前时间
- **cal** 指令，查看日历
  - 基本语法
    - **cal [ 选项 ]**  不加选项，显示本月日历
    - **cal 2020**  显示2020年日历

#### 搜索查找指令

- **find** 指令
  - find 指令将从指定目录向下递归遍历其各个子目录，将满足条件的文件或者目录显示到终端
  - 基本语法
    - **find  [ 搜索范围 ]  [ 选项 ]**
  - 选项说明
    - **-name <文件名>**   按照指定的文件名查找文件
    - **-user <用户名>**  查找属于指定用户的所有文件
    - **-size <文件大小>**  按照指定的文件大小查找文件
  - 例子
    - **find /home -name hello.txt**
    - **find /opt -user nobody**
    - **find / -size +200M**  // 查找系统中大于200M的文件
      - tips：+n 表示大于 n，-n 表示小于 n，n 表示等于 n，n 的单位有 k，M，G
- **locate** 指令，可以快速定位文件路径
  - locate 指令利用事先建立的系统中所有文件名称及路径的locate数据库实现快速定位给定的文件。
  - locate 指令无需遍历整个文件系统，查询速度较快，为了保证查询结果的准确性，管理员必须定期更新locate时刻
  - 基本语法
    - **locate 搜索文件**
    - 由于locate指令基于数据库进行查询，所以第一次运行前，必须使用 **updatedb** 指令创建locate数据库
  - **locate hello.txt**
- **which** 指令，可以查看哪个指令在哪个目录下
  - **which ls**



​	

